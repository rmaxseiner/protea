{% extends "base.html" %}

{% block title %}{% if item %}{{ item.name }}{% else %}Item Not Found{% endif %} - Inventory{% endblock %}

{% block content %}
<div class="p-4 lg:p-6 max-w-4xl mx-auto">
    <!-- Back Link -->
    <a href="/" class="inline-flex items-center text-fynbos-500 hover:text-protea-600 mb-6">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to search
    </a>

    {% if error %}
    <!-- Error State -->
    <div class="bg-protea-50 border border-protea-200 rounded-xl p-6 text-center">
        <svg class="w-12 h-12 mx-auto text-protea-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h2 class="text-xl font-semibold text-protea-700">{{ error }}</h2>
        <p class="text-protea-500 mt-2">The item you're looking for doesn't exist or has been removed.</p>
    </div>

    {% else %}
    <!-- Item Detail -->
    <div class="bg-cream-light rounded-xl border border-cream-dark overflow-hidden">
        <!-- Image Section -->
        {% if item.photo_url %}
        <div class="bg-fynbos-100 p-4">
            <img src="/images/{{ item.photo_url }}"
                 alt="{{ item.name }}"
                 class="max-h-64 mx-auto rounded-lg shadow-md cursor-zoom-in"
                 onclick="openItemLightbox(0)"
                 data-lightbox-src="/images/{{ item.photo_url }}">
        </div>
        {% endif %}

        <!-- Content -->
        <div class="p-6">
            <!-- Header -->
            <div class="flex items-start justify-between gap-4 mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-fynbos-900">{{ item.name }}</h1>
                    <p class="text-fynbos-500 mt-1">
                        {% for part in item.bin_path_parts %}
                            {% if not loop.first %} <span class="text-fynbos-400">&rarr;</span> {% endif %}
                            {% if part.type == "location" %}
                                <a href="/browse/location/{{ part.id }}" class="hover:text-protea-600 hover:underline">{{ part.name }}</a>
                            {% else %}
                                <a href="/browse/bin/{{ part.id }}" class="hover:text-protea-600 hover:underline">{{ part.name }}</a>
                            {% endif %}
                        {% endfor %}
                    </p>
                </div>

                <!-- Quantity Badge -->
                <div class="bg-fynbos-100 px-4 py-2 rounded-lg text-center">
                    <div class="text-2xl font-bold text-fynbos-800">
                        {% if item.quantity_type == 'exact' %}
                            {{ item.quantity_value or 1 }}
                        {% elif item.quantity_type == 'approximate' %}
                            ~{{ item.quantity_value or '?' }}
                        {% else %}
                            1
                        {% endif %}
                    </div>
                    <div class="text-xs text-fynbos-500">
                        {% if item.quantity_label %}{{ item.quantity_label }}{% else %}item{% if (item.quantity_value or 1) != 1 %}s{% endif %}{% endif %}
                    </div>
                </div>
            </div>

            <!-- Details Grid -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <span class="text-sm text-fynbos-500">Quantity Type</span>
                    <p class="font-medium text-fynbos-800 capitalize">{{ item.quantity_type.value }}</p>
                </div>
                <div>
                    <span class="text-sm text-fynbos-500">Source</span>
                    <p class="font-medium text-fynbos-800 capitalize">{{ item.source.value }}</p>
                </div>
                <div>
                    <span class="text-sm text-fynbos-500">Added</span>
                    <p class="font-medium text-fynbos-800">{{ item.created_at.strftime('%b %d, %Y') }}</p>
                </div>
                <div>
                    <span class="text-sm text-fynbos-500">Last Updated</span>
                    <p class="font-medium text-fynbos-800">{{ item.updated_at.strftime('%b %d, %Y') }}</p>
                </div>
            </div>

            {% if item.description %}
            <div class="mb-6">
                <span class="text-sm text-fynbos-500">Description</span>
                <p class="font-medium text-fynbos-800 mt-1">{{ item.description }}</p>
            </div>
            {% endif %}

            {% if item.notes %}
            <div class="mb-6">
                <span class="text-sm text-fynbos-500">Notes</span>
                <p class="font-medium text-fynbos-800 mt-1 whitespace-pre-wrap">{{ item.notes }}</p>
            </div>
            {% endif %}

            <!-- Actions -->
            <div class="border-t border-cream-dark pt-6">
                <h3 class="text-sm font-medium text-fynbos-500 mb-3">Actions</h3>
                <div id="action-buttons" class="flex flex-wrap gap-2">
                    <button type="button" onclick="toggleAddForm()" class="px-4 py-2 bg-fynbos-600 text-white rounded-lg hover:bg-fynbos-700 transition-colors">
                        + Add Quantity
                    </button>
                    <button type="button" onclick="toggleUseForm()" class="px-4 py-2 bg-protea-600 text-white rounded-lg hover:bg-protea-700 transition-colors">
                        - Use Item
                    </button>
                    <button type="button" onclick="toggleEditForm()" class="px-4 py-2 bg-protea-600 text-white rounded-lg hover:bg-protea-700 transition-colors">
                        Edit
                    </button>
                    <button type="button" onclick="toggleMoveForm()" class="px-4 py-2 bg-fynbos-600 text-white rounded-lg hover:bg-fynbos-700 transition-colors">
                        Move
                    </button>
                </div>
            </div>

            <!-- Add Quantity Form (hidden by default) -->
            <div id="add-form" class="hidden border-t border-cream-dark pt-6 mt-6">
                <h3 class="text-sm font-medium text-fynbos-500 mb-4">Add Quantity</h3>
                <form action="/item/{{ item.id }}/add-quantity" method="POST" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="add_quantity" class="block text-sm font-medium text-fynbos-700 mb-1">Quantity to Add</label>
                            <input type="number" name="quantity" id="add_quantity" value="1" min="1"
                                   class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-fynbos-500 focus:border-fynbos-500 bg-white">
                        </div>
                        <div class="flex items-end">
                            <p class="text-sm text-fynbos-500 pb-2">
                                Current: <span class="font-medium text-fynbos-800">{{ item.quantity_value or 1 }}</span>
                                {% if item.quantity_label %}{{ item.quantity_label }}{% endif %}
                            </p>
                        </div>
                    </div>

                    <div>
                        <label for="add_notes" class="block text-sm font-medium text-fynbos-700 mb-1">Notes (optional)</label>
                        <input type="text" name="notes" id="add_notes" placeholder="e.g., Restocked from Amazon"
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-fynbos-500 focus:border-fynbos-500 bg-white">
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="submit" class="px-4 py-2 bg-fynbos-600 text-white rounded-lg hover:bg-fynbos-700 transition-colors">
                            Add Stock
                        </button>
                        <button type="button" onclick="toggleAddForm()" class="px-4 py-2 bg-fynbos-200 text-fynbos-700 rounded-lg hover:bg-fynbos-300 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Use Item Form (hidden by default) -->
            <div id="use-form" class="hidden border-t border-cream-dark pt-6 mt-6">
                <h3 class="text-sm font-medium text-fynbos-500 mb-4">Use Item</h3>
                <form action="/item/{{ item.id }}/use" method="POST" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="use_quantity" class="block text-sm font-medium text-fynbos-700 mb-1">Quantity to Use</label>
                            <input type="number" name="quantity" id="use_quantity" value="1" min="1" max="{{ item.quantity_value or 1 }}"
                                   class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                        </div>
                        <div class="flex items-end">
                            <p class="text-sm text-fynbos-500 pb-2">
                                Current: <span class="font-medium text-fynbos-800">{{ item.quantity_value or 1 }}</span>
                                {% if item.quantity_label %}{{ item.quantity_label }}{% endif %}
                            </p>
                        </div>
                    </div>

                    <div>
                        <label for="use_notes" class="block text-sm font-medium text-fynbos-700 mb-1">Notes (optional)</label>
                        <input type="text" name="notes" id="use_notes" placeholder="e.g., Used for project X"
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="submit" class="px-4 py-2 bg-protea-600 text-white rounded-lg hover:bg-protea-700 transition-colors">
                            Confirm Use
                        </button>
                        <button type="button" onclick="toggleUseForm()" class="px-4 py-2 bg-fynbos-200 text-fynbos-700 rounded-lg hover:bg-fynbos-300 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Edit Form (hidden by default) -->
            <div id="edit-form" class="hidden border-t border-cream-dark pt-6 mt-6">
                <h3 class="text-sm font-medium text-fynbos-500 mb-4">Edit Item</h3>
                <form action="/item/{{ item.id }}/edit" method="POST" class="space-y-4">
                    <!-- Name -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-fynbos-700 mb-1">Name</label>
                        <input type="text" name="name" id="name" value="{{ item.name }}" required
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-sm font-medium text-fynbos-700 mb-1">Description</label>
                        <input type="text" name="description" id="description" value="{{ item.description or '' }}"
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                    </div>

                    <!-- Quantity Type -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="quantity_type" class="block text-sm font-medium text-fynbos-700 mb-1">Quantity Type</label>
                            <select name="quantity_type" id="quantity_type"
                                    class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                                <option value="exact" {% if item.quantity_type.value == 'exact' %}selected{% endif %}>Exact</option>
                                <option value="approximate" {% if item.quantity_type.value == 'approximate' %}selected{% endif %}>Approximate</option>
                                <option value="boolean" {% if item.quantity_type.value == 'boolean' %}selected{% endif %}>Boolean (has/doesn't have)</option>
                            </select>
                        </div>

                        <div>
                            <label for="quantity_value" class="block text-sm font-medium text-fynbos-700 mb-1">Quantity</label>
                            <input type="number" name="quantity_value" id="quantity_value" value="{{ item.quantity_value or 1 }}" min="0"
                                   class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                        </div>
                    </div>

                    <!-- Quantity Label -->
                    <div>
                        <label for="quantity_label" class="block text-sm font-medium text-fynbos-700 mb-1">Quantity Label</label>
                        <input type="text" name="quantity_label" id="quantity_label" value="{{ item.quantity_label or '' }}"
                               placeholder="e.g., pieces, rolls, assorted"
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">
                    </div>

                    <!-- Notes -->
                    <div>
                        <label for="notes" class="block text-sm font-medium text-fynbos-700 mb-1">Notes</label>
                        <textarea name="notes" id="notes" rows="3"
                                  class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-protea-500 focus:border-protea-500 bg-white">{{ item.notes or '' }}</textarea>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex gap-3 pt-2">
                        <button type="submit" class="px-4 py-2 bg-protea-600 text-white rounded-lg hover:bg-protea-700 transition-colors">
                            Save Changes
                        </button>
                        <button type="button" onclick="toggleEditForm()" class="px-4 py-2 bg-fynbos-200 text-fynbos-700 rounded-lg hover:bg-fynbos-300 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Move Item Form (hidden by default) -->
            <div id="move-form" class="hidden border-t border-cream-dark pt-6 mt-6">
                <h3 class="text-sm font-medium text-fynbos-500 mb-4">Move Item</h3>
                <form action="/item/{{ item.id }}/move" method="POST" class="space-y-4">
                    <div>
                        <label for="to_bin_id" class="block text-sm font-medium text-fynbos-700 mb-1">Move to Bin</label>
                        <select name="to_bin_id" id="to_bin_id" required
                                class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-fynbos-500 focus:border-fynbos-500 bg-white">
                            {% for bin in all_bins %}
                            <option value="{{ bin.id }}" {% if bin.is_current %}disabled{% endif %}>
                                {{ bin.location_name }} &rarr; {{ bin.name }}{% if bin.is_current %} (current){% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label for="move_notes" class="block text-sm font-medium text-fynbos-700 mb-1">Notes (optional)</label>
                        <input type="text" name="notes" id="move_notes" placeholder="e.g., Reorganizing storage"
                               class="w-full px-3 py-2 border border-cream-dark rounded-lg focus:ring-2 focus:ring-fynbos-500 focus:border-fynbos-500 bg-white">
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button type="submit" class="px-4 py-2 bg-fynbos-600 text-white rounded-lg hover:bg-fynbos-700 transition-colors">
                            Move Item
                        </button>
                        <button type="button" onclick="toggleMoveForm()" class="px-4 py-2 bg-fynbos-200 text-fynbos-700 rounded-lg hover:bg-fynbos-300 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Activity History -->
    {% if history %}
    <div class="mt-8">
        <h2 class="text-lg font-semibold text-fynbos-900 mb-4">Activity History</h2>
        <div class="space-y-3">
            {% for entry in history %}
            <div class="bg-cream-light rounded-lg border border-cream-dark p-4">
                <div class="flex items-start gap-3">
                    <!-- Action Icon -->
                    <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0
                                {% if entry.action.value == 'added' %}bg-fynbos-100 text-fynbos-600
                                {% elif entry.action.value == 'used' %}bg-protea-100 text-protea-600
                                {% elif entry.action.value == 'removed' %}bg-protea-100 text-protea-600
                                {% elif entry.action.value == 'moved' %}bg-fynbos-100 text-fynbos-600
                                {% else %}bg-fynbos-100 text-fynbos-600{% endif %}">
                        {% if entry.action.value == 'added' %}
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        {% elif entry.action.value == 'used' or entry.action.value == 'removed' %}
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                        </svg>
                        {% elif entry.action.value == 'moved' %}
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                        </svg>
                        {% else %}
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        {% endif %}
                    </div>

                    <!-- Entry Details -->
                    <div class="flex-1">
                        <p class="text-fynbos-900">
                            <span class="font-medium capitalize">{{ entry.action.value }}</span>
                            {% if entry.quantity_change %}
                                ({% if entry.quantity_change > 0 %}+{% endif %}{{ entry.quantity_change }})
                            {% endif %}
                        </p>
                        {% if entry.notes %}
                        <p class="text-sm text-fynbos-500 mt-1">{{ entry.notes }}</p>
                        {% endif %}
                        <p class="text-xs text-fynbos-400 mt-1">{{ entry.created_at.strftime('%b %d, %Y at %I:%M %p') }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% endif %}
</div>

<!-- Image Lightbox Modal -->
<div id="item-lightbox" class="fixed inset-0 z-50 hidden bg-black/90 flex items-center justify-center" onclick="closeItemLightboxOnBackdrop(event)">
    <!-- Close button -->
    <button onclick="closeItemLightbox()" class="absolute top-4 right-4 text-white/70 hover:text-white p-2 z-10" title="Close (Esc)">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>

    <!-- Previous button -->
    <button onclick="navigateItemLightbox(-1)" id="item-lightbox-prev" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-2 z-10 hidden" title="Previous (Left Arrow)">
        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
    </button>

    <!-- Next button -->
    <button onclick="navigateItemLightbox(1)" id="item-lightbox-next" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-2 z-10 hidden" title="Next (Right Arrow)">
        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
    </button>

    <!-- Image container -->
    <div class="max-w-[90vw] max-h-[85vh] relative">
        <img id="item-lightbox-image" src="" alt="Enlarged image" class="max-w-full max-h-[85vh] object-contain">

        <!-- Bottom toolbar -->
        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 flex items-center justify-between">
            <!-- Image counter -->
            <span id="item-lightbox-counter" class="text-white/80 text-sm"></span>

            <!-- Copy button -->
            <button onclick="copyItemLightboxImage()" id="copy-image-btn" class="flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                </svg>
                <span id="item-copy-btn-text">Copy Image</span>
            </button>
        </div>
    </div>
</div>

<script>
// Lightbox state
window.currentLightboxIndex = 0;

// Get all lightbox image URLs
window.getItemLightboxImages = function() {
    const imgs = document.querySelectorAll('[data-lightbox-src]');
    return Array.from(imgs).map(img => img.dataset.lightboxSrc);
};

window.openItemLightbox = function(index) {
    const lightboxImages = getItemLightboxImages();
    if (lightboxImages.length === 0) return;

    currentLightboxIndex = index;
    const lightbox = document.getElementById('item-lightbox');
    const img = document.getElementById('item-lightbox-image');

    // Show lightbox first
    lightbox.classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    // Then set image and update UI
    img.src = lightboxImages[index];
    updateItemLightboxUI();

    // Add keyboard listener
    document.addEventListener('keydown', handleItemLightboxKeydown);
};

window.closeItemLightbox = function() {
    const lightbox = document.getElementById('item-lightbox');
    lightbox.classList.add('hidden');
    document.body.style.overflow = '';
    document.removeEventListener('keydown', handleItemLightboxKeydown);
};

window.closeItemLightboxOnBackdrop = function(event) {
    if (event.target.id === 'item-lightbox') {
        closeItemLightbox();
    }
};

window.navigateItemLightbox = function(direction) {
    const lightboxImages = getItemLightboxImages();
    if (lightboxImages.length <= 1) return;

    currentLightboxIndex += direction;

    if (currentLightboxIndex < 0) {
        currentLightboxIndex = lightboxImages.length - 1;
    } else if (currentLightboxIndex >= lightboxImages.length) {
        currentLightboxIndex = 0;
    }

    const img = document.getElementById('item-lightbox-image');
    img.src = lightboxImages[currentLightboxIndex];
    updateItemLightboxUI();
};

window.updateItemLightboxUI = function() {
    const lightboxImages = getItemLightboxImages();
    const counter = document.getElementById('item-lightbox-counter');
    const prevBtn = document.getElementById('item-lightbox-prev');
    const nextBtn = document.getElementById('item-lightbox-next');

    counter.textContent = `${currentLightboxIndex + 1} / ${lightboxImages.length}`;

    if (lightboxImages.length <= 1) {
        prevBtn.classList.add('hidden');
        nextBtn.classList.add('hidden');
        counter.classList.add('hidden');
    } else {
        prevBtn.classList.remove('hidden');
        nextBtn.classList.remove('hidden');
        counter.classList.remove('hidden');
    }

    document.getElementById('item-copy-btn-text').textContent = 'Copy Image';
};

window.handleItemLightboxKeydown = function(event) {
    switch (event.key) {
        case 'Escape':
            closeItemLightbox();
            break;
        case 'ArrowLeft':
            navigateItemLightbox(-1);
            break;
        case 'ArrowRight':
            navigateItemLightbox(1);
            break;
    }
};

window.copyItemLightboxImage = async function() {
    const img = document.getElementById('item-lightbox-image');
    const btnText = document.getElementById('item-copy-btn-text');

    try {
        const response = await fetch(img.src);
        const blob = await response.blob();
        const item = new ClipboardItem({ [blob.type]: blob });
        await navigator.clipboard.write([item]);

        btnText.textContent = 'Copied!';
        setTimeout(() => {
            btnText.textContent = 'Copy Image';
        }, 2000);
    } catch (err) {
        console.error('Failed to copy image:', err);
        btnText.textContent = 'Copy failed';
        setTimeout(() => {
            btnText.textContent = 'Copy Image';
        }, 2000);
    }
};

// Item page specific functions
function toggleAddForm() {
    toggleForm('add-form');
}

function toggleUseForm() {
    toggleForm('use-form');
}

function toggleEditForm() {
    toggleForm('edit-form');
}

function toggleMoveForm() {
    toggleForm('move-form');
}

function toggleForm(formId) {
    const forms = ['add-form', 'use-form', 'edit-form', 'move-form'];
    forms.forEach(id => {
        const el = document.getElementById(id);
        if (id === formId) {
            el.classList.toggle('hidden');
        } else {
            el.classList.add('hidden');
        }
    });
}
</script>
{% endblock %}
