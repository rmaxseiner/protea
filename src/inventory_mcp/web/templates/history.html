{% extends "base.html" %}

{% block title %}History - Inventory{% endblock %}

{% block content %}
<div class="p-4 lg:p-6 max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold text-fynbos-900 mb-6">Activity History</h1>

    {% if history_dates %}
    <div class="space-y-8">
        {% for date, entries in history_dates %}
        <div>
            <!-- Date Header -->
            <h2 class="text-sm font-medium text-fynbos-500 mb-3 sticky top-14 lg:top-0 bg-cream py-2 z-10">
                {% set date_obj = entries[0].created_at %}
                {{ date_obj.strftime('%A, %B %d, %Y') }}
            </h2>

            <!-- Activity Entries -->
            <div class="space-y-3">
                {% for entry in entries %}
                <div class="bg-cream-light rounded-xl border border-cream-dark p-4">
                    <div class="flex gap-4">
                        <!-- Action Icon -->
                        <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0
                                    {% if entry.action == 'added' %}bg-fynbos-100 text-fynbos-600
                                    {% elif entry.action == 'used' %}bg-protea-100 text-protea-600
                                    {% elif entry.action == 'removed' %}bg-protea-100 text-protea-600
                                    {% elif entry.action == 'moved' %}bg-fynbos-100 text-fynbos-600
                                    {% else %}bg-fynbos-100 text-fynbos-600{% endif %}">
                            {% if entry.action == 'added' %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                            {% elif entry.action == 'used' or entry.action == 'removed' %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                            </svg>
                            {% elif entry.action == 'moved' %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                            </svg>
                            {% else %}
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            {% endif %}
                        </div>

                        <!-- Entry Details -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between gap-2">
                                <div>
                                    <!-- Item Link -->
                                    <a href="/item/{{ entry.item_id }}"
                                       class="font-semibold text-fynbos-900 hover:text-protea-600">
                                        {{ entry.item_name }}
                                    </a>

                                    <!-- Action Description -->
                                    <p class="text-fynbos-600 mt-1">
                                        <span class="capitalize font-medium">{{ entry.action }}</span>
                                        {% if entry.quantity_change %}
                                            <span class="{% if entry.quantity_change > 0 %}text-fynbos-600{% else %}text-protea-600{% endif %}">
                                                ({% if entry.quantity_change > 0 %}+{% endif %}{{ entry.quantity_change }})
                                            </span>
                                        {% endif %}
                                    </p>

                                    <!-- Location -->
                                    {% if entry.location_name and entry.bin_name %}
                                    <p class="text-sm text-fynbos-500 mt-1">
                                        {{ entry.location_name }} &rarr; {{ entry.bin_name }}
                                    </p>
                                    {% endif %}

                                    <!-- Notes -->
                                    {% if entry.notes %}
                                    <p class="text-sm text-fynbos-500 mt-2 italic">{{ entry.notes }}</p>
                                    {% endif %}
                                </div>

                                <!-- Thumbnail -->
                                {% if entry.item_photo %}
                                <img src="/images/{{ entry.item_photo }}?thumb=1"
                                     alt="{{ entry.item_name }}"
                                     class="w-12 h-12 object-cover rounded-lg flex-shrink-0 bg-fynbos-100">
                                {% endif %}
                            </div>

                            <!-- Timestamp -->
                            <p class="text-xs text-fynbos-400 mt-2">
                                {{ entry.created_at.strftime('%I:%M %p') }}
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="bg-cream-light rounded-xl border border-cream-dark p-8 text-center">
        <svg class="w-12 h-12 mx-auto text-fynbos-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h2 class="text-xl font-semibold text-fynbos-700">No Activity Yet</h2>
        <p class="text-fynbos-500 mt-2">Activity will appear here as you add, use, or move items.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
