# Inventory MCP Server - Status Report

**Date:** January 16, 2026
**Status:** Location Pages & Automated Deployment
**Version:** 0.3.1
**Repository:** https://git.maxseiner.casa/ron-maxseiner/inventory-mcp.git
**Branch:** main
**Commit:** c54a771

---

## Executive Summary

Infrastructure and UI improvements focused on location management and deployment automation:
1. **Location Detail Pages** - View, edit, delete locations and add bins from web UI
2. **Download Images as Zip** - Download all bin images with folder structure preserved
3. **Automated Deployment** - Webhook-triggered deployment after CI build
4. **Mobile Layout Fix** - Fixed location page layout on narrow screens

---

## Completed Today

### 1. Location Detail Pages
Full location management from the web UI.

**Features:**
- Location detail page at `/browse/location/{id}`
- Edit location name and description
- Delete location (only when empty - no bins)
- Add new bins directly from location page
- Clickable location names in browse page
- Updated breadcrumbs in bin and item pages to link to location

**Routes Added:**
| Route | Method | Description |
|-------|--------|-------------|
| `/browse/location/{id}` | GET | View location detail |
| `/browse/location/{id}/edit` | POST | Update location |
| `/browse/location/{id}/delete` | POST | Delete empty location |
| `/browse/location/{id}/create-bin` | POST | Add new bin |

**Files:**
- `src/inventory_mcp/web/templates/location.html` - NEW: Location detail template
- `src/inventory_mcp/web/routes/pages.py` - Location routes
- `src/inventory_mcp/web/templates/browse.html` - Clickable location headers
- `src/inventory_mcp/web/templates/bin.html` - Updated breadcrumbs
- `src/inventory_mcp/web/templates/item.html` - Updated breadcrumbs

---

### 2. Download Images as Zip
Download all images from a bin and its children as a zip file.

**Features:**
- Download button on bin detail page
- Preserves folder hierarchy matching bin structure
- Sanitized filenames (spaces → dashes)
- Naming: `bin-name.jpg` or `bin-name-1.jpg`, `bin-name-2.jpg` for multiple
- Empty folders created for bins without images

**Route:**
- `GET /browse/bin/{id}/download-images` → Returns zip file

**Use Case:**
Enables bulk export of bin photos for processing in Claude Desktop (drag & drop images for item extraction).

---

### 3. Automated Deployment Pipeline
CI/CD now automatically deploys to server after successful build.

**Architecture:**
```
┌─────────────────────────────────────────────────────────────┐
│                     Deployment Flow                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   git push main                                              │
│        │                                                     │
│        ▼                                                     │
│   ┌─────────────┐                                           │
│   │ Gitea CI/CD │ Build → Push to Registry                  │
│   └─────────────┘                                           │
│        │                                                     │
│        ▼ curl webhook                                        │
│   ┌─────────────────────────────────────────┐               │
│   │ webhook.maxseiner.casa (port 9002)      │               │
│   │ → Nginx Proxy Manager → webhook service │               │
│   └─────────────────────────────────────────┘               │
│        │                                                     │
│        ▼ executes deploy script                              │
│   ┌─────────────────────────────────────────┐               │
│   │ docker compose pull && up -d            │               │
│   └─────────────────────────────────────────┘               │
│        │                                                     │
│        ▼                                                     │
│   Container restarted with new image                         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Components:**
| Component | Location | Purpose |
|-----------|----------|---------|
| Webhook service | Server (apt install webhook) | Listens for deploy triggers |
| Deploy script | `/opt/scripts/deploy-inventory.sh` | Runs docker compose commands |
| Webhook config | `/etc/webhook/hooks.json` | Token auth & script binding |
| CI workflow | `.gitea/workflows/build-container.yml` | Triggers webhook after build |

**Gitea Secrets:**
- `DEPLOY_WEBHOOK_URL` - Webhook endpoint URL
- `DEPLOY_TOKEN` - Authentication token

**Timing:**
- CI Build: ~2-3 minutes
- Webhook deploy: ~10-15 seconds
- Total: ~2-3 minutes from push to running

---

### 4. Mobile Layout Fix
Fixed location page bin list layout on mobile devices.

**Problem:** Page was too wide on mobile, causing text to shrink.

**Solution:**
- Added `min-w-0` and `truncate` for text truncation
- Added `flex-shrink-0` to prevent icon/badge shrinking
- Hidden sub-bin count badge on mobile (`hidden sm:inline`)
- Added `whitespace-nowrap` to prevent count text wrapping

---

## Files Changed Today

| File | Change |
|------|--------|
| `src/inventory_mcp/web/templates/location.html` | NEW: Location detail page |
| `src/inventory_mcp/web/routes/pages.py` | Location routes, download zip route |
| `src/inventory_mcp/web/templates/browse.html` | Clickable location headers |
| `src/inventory_mcp/web/templates/bin.html` | Breadcrumb links, download button |
| `src/inventory_mcp/web/templates/item.html` | Breadcrumb links to location |
| `.gitea/workflows/build-container.yml` | Automated deployment step |

---

## Server Configuration Added

| File | Purpose |
|------|---------|
| `/opt/scripts/deploy-inventory.sh` | Deployment script |
| `/etc/webhook/hooks.json` | Webhook configuration |
| `/etc/systemd/system/webhook.service` | Webhook systemd service |

---

## Issues Resolved

| Issue | Resolution |
|-------|------------|
| No location management in web UI | Added location detail pages |
| Manual container deployment | Automated via webhook |
| Location page too wide on mobile | Added responsive classes |
| Can't bulk download bin images | Added zip download feature |
| Breadcrumbs don't link to location | Updated all templates |

---

## Remaining TODO

### Low Priority - Future Enhancements
| Feature | Description |
|---------|-------------|
| Create locations from web UI | Add new locations via browse page |
| Bulk operations | Select multiple items for move/delete |
| PWA support | Installable mobile app experience |
| Barcode scanning | Camera-based UPC lookup |
| Data export | CSV/JSON export for backup/migration |

---

## Session Statistics

| Metric | Value |
|--------|-------|
| Commits today | 5 |
| New files | 1 |
| Modified files | 6 |
| Features added | 4 |
| Issues resolved | 5 |

---

*Report generated: January 16, 2026*
