# Inventory MCP Server - Status Report

**Date:** January 16, 2026
**Status:** Quick Add Mode & Automated Deployment
**Version:** 0.3.1
**Repository:** https://git.maxseiner.casa/ron-maxseiner/inventory-mcp.git
**Branch:** main
**Commit:** 6d2e0d0

---

## Executive Summary

Major workflow improvements focused on rapid bin creation and deployment automation:
1. **Quick Add Mode** - Streamlined workflow for rapidly adding multiple sub-bins with photos
2. **Auto-Upload Photos** - Photos upload immediately on selection (no Upload button)
3. **Location Detail Pages** - View, edit, delete locations and add bins from web UI
4. **Download Images as Zip** - Download all bin images with folder structure preserved
5. **Automated Deployment** - Webhook-triggered deployment after CI build
6. **Mobile Readability** - Increased font size and fixed layout issues
7. **Bug Fix** - Fixed `list_items` MCP tool `include_children` parameter for bin filtering

---

## Completed Today

### 1. Quick Add Mode
Streamlined workflow for rapidly creating multiple sub-bins with photos.

**Workflow:**
1. Go to any bin page → Click "Quick Add" button
2. Enter bin name/description → Save
3. Take/select photos (auto-upload on selection)
4. Click "Next Bin" to add another
5. Click "Done" when finished

**Features:**
- Dedicated quick-add page at `/browse/bin/{id}/quick-add`
- Auto-upload photos immediately on selection
- Delete photos with tap on X
- Session summary shows bins added
- Pre-fill name/description from bin page form
- First photo automatically set as primary

**Routes Added:**
| Route | Method | Description |
|-------|--------|-------------|
| `/browse/bin/{id}/quick-add` | GET | Quick add page |
| `/browse/bin/{id}/quick-add/save` | POST | AJAX: Create sub-bin |
| `/browse/bin/{id}/quick-add/upload-photo/{child_id}` | POST | AJAX: Upload photo |
| `/browse/bin/{id}/quick-add/delete-photo/{image_id}` | POST | AJAX: Delete photo |

---

### 2. Auto-Upload Photos
Simplified photo upload across all bin pages.

**Changes:**
- Photos upload immediately when selected (no "Upload" button)
- First photo automatically becomes primary
- Removed caption and primary checkbox fields
- Shows upload spinner during upload
- Consistent experience across bin page and quick-add

---

### 3. Location Detail Pages
Full location management from the web UI.

**Features:**
- Location detail page at `/browse/location/{id}`
- Edit location name and description
- Delete location (only when empty - no bins)
- Add new bins directly from location page
- Clickable location names in browse page
- Updated breadcrumbs in bin and item pages to link to location

**Routes Added:**
| Route | Method | Description |
|-------|--------|-------------|
| `/browse/location/{id}` | GET | View location detail |
| `/browse/location/{id}/edit` | POST | Update location |
| `/browse/location/{id}/delete` | POST | Delete empty location |
| `/browse/location/{id}/create-bin` | POST | Add new bin |

**Files:**
- `src/inventory_mcp/web/templates/location.html` - NEW: Location detail template
- `src/inventory_mcp/web/routes/pages.py` - Location routes
- `src/inventory_mcp/web/templates/browse.html` - Clickable location headers
- `src/inventory_mcp/web/templates/bin.html` - Updated breadcrumbs
- `src/inventory_mcp/web/templates/item.html` - Updated breadcrumbs

---

### 4. Download Images as Zip
Download all images from a bin and its children as a zip file.

**Features:**
- Download button on bin detail page
- Preserves folder hierarchy matching bin structure
- Sanitized filenames (spaces → dashes)
- Naming: `bin-name.jpg` or `bin-name-1.jpg`, `bin-name-2.jpg` for multiple
- Empty folders created for bins without images

**Route:**
- `GET /browse/bin/{id}/download-images` → Returns zip file

**Use Case:**
Enables bulk export of bin photos for processing in Claude Desktop (drag & drop images for item extraction).

---

### 5. Automated Deployment Pipeline
CI/CD now automatically deploys to server after successful build.

**Architecture:**
```
┌─────────────────────────────────────────────────────────────┐
│                     Deployment Flow                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│   git push main                                              │
│        │                                                     │
│        ▼                                                     │
│   ┌─────────────┐                                           │
│   │ Gitea CI/CD │ Build → Push to Registry                  │
│   └─────────────┘                                           │
│        │                                                     │
│        ▼ curl webhook                                        │
│   ┌─────────────────────────────────────────┐               │
│   │ webhook.maxseiner.casa (port 9002)      │               │
│   │ → Nginx Proxy Manager → webhook service │               │
│   └─────────────────────────────────────────┘               │
│        │                                                     │
│        ▼ executes deploy script                              │
│   ┌─────────────────────────────────────────┐               │
│   │ docker compose pull && up -d            │               │
│   └─────────────────────────────────────────┘               │
│        │                                                     │
│        ▼                                                     │
│   Container restarted with new image                         │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Components:**
| Component | Location | Purpose |
|-----------|----------|---------|
| Webhook service | Server (apt install webhook) | Listens for deploy triggers |
| Deploy script | `/opt/scripts/deploy-inventory.sh` | Runs docker compose commands |
| Webhook config | `/etc/webhook/hooks.json` | Token auth & script binding |
| CI workflow | `.gitea/workflows/build-container.yml` | Triggers webhook after build |

**Gitea Secrets:**
- `DEPLOY_WEBHOOK_URL` - Webhook endpoint URL
- `DEPLOY_TOKEN` - Authentication token

**Timing:**
- CI Build: ~2-3 minutes
- Webhook deploy: ~10-15 seconds
- Total: ~2-3 minutes from push to running

---

### 6. Mobile Readability Improvements
Fixed mobile layout and font sizing for better usability.

**Layout Fix (Location Page):**
- Added `min-w-0` and `truncate` for text truncation
- Added `flex-shrink-0` to prevent icon/badge shrinking
- Hidden sub-bin count badge on mobile (`hidden sm:inline`)

**Font Size Fix (All Pages):**
- Increased base font from 16px → 18px on mobile (screens < 640px)
- All text scales proportionally for better readability
- Input fields remain at 16px to prevent iOS auto-zoom

---

### 7. Bug Fix: list_items include_children Parameter
Fixed the `list_items` MCP tool where `include_children` parameter was ignored for bin filtering.

**Problem:**
- `include_children=True` only worked for `category_id` filtering
- When filtering by `bin_id`, child bins were never included

**Fix:**
- Added recursive `get_child_bin_ids()` function to traverse bin hierarchy
- When `include_children=True` and `bin_id` is provided, query now uses `IN (...)` with all child bin IDs
- Consistent behavior between bin and category filtering

**File Changed:**
- `src/inventory_mcp/tools/search.py` - Added child bin recursion in `list_items()`

---

## Files Changed Today

| File | Change |
|------|--------|
| `src/inventory_mcp/web/templates/quick_add.html` | NEW: Quick add sub-bins page |
| `src/inventory_mcp/web/templates/location.html` | NEW: Location detail page |
| `src/inventory_mcp/web/routes/pages.py` | Quick add routes, location routes, download zip |
| `src/inventory_mcp/web/templates/browse.html` | Clickable location headers |
| `src/inventory_mcp/web/templates/bin.html` | Quick Add button, auto-upload photos |
| `src/inventory_mcp/web/templates/item.html` | Breadcrumb links to location |
| `src/inventory_mcp/web/static/app.css` | Mobile font scaling |
| `.gitea/workflows/build-container.yml` | Automated deployment step |
| `src/inventory_mcp/tools/search.py` | Fix include_children for bin_id filtering |

---

## Server Configuration Added

| File | Purpose |
|------|---------|
| `/opt/scripts/deploy-inventory.sh` | Deployment script |
| `/etc/webhook/hooks.json` | Webhook configuration |
| `/etc/systemd/system/webhook.service` | Webhook systemd service |

---

## Issues Resolved

| Issue | Resolution |
|-------|------------|
| Tedious workflow for adding multiple bins | Quick Add mode with streamlined flow |
| Photo upload requires multiple clicks | Auto-upload on selection |
| No location management in web UI | Added location detail pages |
| Manual container deployment | Automated via webhook |
| Location page too wide on mobile | Added responsive classes |
| Text too small on mobile | Increased base font to 18px |
| Can't bulk download bin images | Added zip download feature |
| Breadcrumbs don't link to location | Updated all templates |
| list_items include_children ignores bin_id | Added recursive child bin lookup |

---

## Remaining TODO

### Low Priority - Future Enhancements
| Feature | Description |
|---------|-------------|
| Create locations from web UI | Add new locations via browse page |
| Bulk operations | Select multiple items for move/delete |
| PWA support | Installable mobile app experience |
| Barcode scanning | Camera-based UPC lookup |
| Data export | CSV/JSON export for backup/migration |

---

## Session Statistics

| Metric | Value |
|--------|-------|
| Commits today | 11 |
| New files | 2 |
| Modified files | 8 |
| Features added | 6 |
| Bug fixes | 1 |
| Issues resolved | 9 |

---

*Report generated: January 16, 2026*
