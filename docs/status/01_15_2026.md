# Inventory MCP Server - Status Report

**Date:** January 15, 2026
**Status:** Semantic Search Complete, All Major Features Implemented
**Version:** 0.3.0
**Repository:** https://git.maxseiner.casa/ron-maxseiner/inventory-mcp.git
**Branch:** main
**Commit:** ceb1bcd

---

## Executive Summary

Major feature day with significant functionality added:
1. **Semantic/Vector Search** - Hybrid FTS + embedding search finds related items by meaning
2. **Item Actions** - Edit, Use, Add Quantity, Move Item all working
3. **Sub-bin Management** - Create and delete child bins from web UI
4. **HTTPS Proxy Fix** - Resolved mixed content errors behind reverse proxy
5. **UI Polish** - King Protea icon, improved lightbox with zoom toggle

---

## Completed Today

### 1. Vector/Semantic Search
Full implementation of hybrid search combining FTS5 with Sentence Transformers embeddings.

**Features:**
- Automatic embedding generation on item create/update
- Hybrid scoring: combines keyword (FTS) and semantic (vector) matches
- Graceful fallback to FTS-only if embeddings unavailable
- CPU-only PyTorch for smaller container size (~800MB vs ~3GB)
- Backfill CLI command: `inventory-backfill`

**Example:**
- Search "hardware" → finds "G.Skill Ripjaws DDR4 SO-DIMM RAM", "Atari THE400 Mini Console"
- Search "cable" → finds all USB cables, SATA cables, etc.
- Works even when search terms don't appear in item names

**New Files:**
- `src/inventory_mcp/services/embedding_service.py` - Embedding generation & similarity
- `src/inventory_mcp/db/migrations/004_item_embeddings.sql` - Adds embedding column
- `src/inventory_mcp/backfill_embeddings.py` - CLI backfill tool

**Configuration:**
| Variable | Default | Description |
|----------|---------|-------------|
| `INVENTORY_EMBEDDING_ENABLED` | `true` | Enable/disable vector search |
| `INVENTORY_EMBEDDING_MODEL` | `all-MiniLM-L6-v2` | Sentence Transformer model |
| `INVENTORY_VECTOR_SEARCH_WEIGHT` | `0.5` | Weight for vector scores |
| `INVENTORY_FTS_SEARCH_WEIGHT` | `0.5` | Weight for FTS scores |

---

### 2. Item Action Buttons
All four item actions now working on item detail page:

| Action | Description | Form Fields |
|--------|-------------|-------------|
| **Edit Item** | Modify item details | Name, description, quantity, notes |
| **Use Item** | Decrement quantity | Amount to use, optional notes |
| **Add Quantity** | Increment quantity | Amount to add, optional notes |
| **Move Item** | Relocate to different bin | Target bin dropdown |

**UI Behavior:**
- Buttons displayed in action bar below item details
- Only one form visible at a time (others hide when one opens)
- Forms scroll into view when opened
- All actions logged to activity history

---

### 3. Sub-bin Management
Added ability to create and delete child bins from bin detail page.

**Features:**
- "Add Sub-bin" form with name and optional description
- Delete button (trash icon) on each child bin
- Validation: cannot delete bins that contain items
- Error messages displayed at top of page

---

### 4. HTTPS Proxy Fix
Resolved mixed content errors when running behind Nginx Proxy Manager.

**Problem:** Static assets loaded via `http://` URLs on `https://` page, causing browser blocks.

**Solution:** Changed from `url_for('static', ...)` to relative URLs `/static/...` in templates.

**Files Changed:**
- `src/inventory_mcp/web/templates/base.html` - All static asset URLs

---

### 5. Lightbox Improvements
Fixed image lightbox to start fitted to screen with tap-to-zoom toggle.

**Behavior:**
- Click/tap image → opens fitted to screen
- Click/tap in lightbox → toggles between fit and 100% zoom
- Hint text shows current state ("Tap image to zoom" / "Tap to fit screen")
- Pinch-zoom still available on touch devices

---

### 6. King Protea Icon
Created stylized King Protea SVG icons matching the app's color scheme.

**Files:**
- `src/inventory_mcp/web/static/favicon.svg` - 32x32 favicon
- `src/inventory_mcp/web/static/protea-icon.svg` - 64x64 detailed version

**Usage:**
- Browser tab favicon
- Sidebar logo (desktop and mobile)
- Mobile header icon

---

## Architecture Update

```
┌─────────────────────────────────────────────────────────────┐
│                    Docker Container                          │
│            git.maxseiner.casa/ron-maxseiner/inventory-mcp   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ inventory-web│  │inventory-mcp │  │inventory-mcp │       │
│  │   (web UI)   │  │   (stdio)    │  │    -sse      │       │
│  │   Port 8080  │  │  No port     │  │  Port 8081   │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│         │                                    │               │
│         └────────────┬───────────────────────┘               │
│                      ▼                                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                    SQLite DB                          │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌────────────┐  │   │
│  │  │  Items  │ │  Bins   │ │  FTS5   │ │ Embeddings │  │   │
│  │  │         │ │(nested) │ │ Search  │ │  (BLOB)    │  │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └────────────┘  │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Sentence Transformers                    │   │
│  │           (all-MiniLM-L6-v2, CPU-only)               │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## Issues Resolved

| Issue | Resolution |
|-------|------------|
| Mixed content errors behind HTTPS proxy | Changed to relative URLs |
| Lightbox opens at 100% zoom | Now opens fitted to screen |
| No item edit/use/add/move actions | All four actions implemented |
| Cannot create/delete sub-bins | Added forms and buttons |
| No semantic search | Hybrid FTS + vector search implemented |
| Container image too large (3GB) | CPU-only PyTorch (~800MB) |
| Build cache preventing updates | Added no-cache workflow option |

---

## Remaining TODO

### Low Priority - Future Enhancements
| Feature | Description |
|---------|-------------|
| Bulk operations | Select multiple items for move/delete |
| PWA support | Installable mobile app experience |
| Barcode scanning | Camera-based UPC lookup |
| Data export | CSV/JSON export for backup/migration |
| Create locations from web UI | Add new locations via web interface |

---

## Files Changed Today

| File | Change |
|------|--------|
| `pyproject.toml` | Added numpy, optional sentence-transformers |
| `src/inventory_mcp/config.py` | Embedding configuration settings |
| `src/inventory_mcp/services/__init__.py` | Export embedding_service |
| `src/inventory_mcp/services/embedding_service.py` | NEW: Vector embeddings |
| `src/inventory_mcp/db/migrations/004_item_embeddings.sql` | NEW: Embedding column |
| `src/inventory_mcp/tools/items.py` | Generate embeddings on create/update |
| `src/inventory_mcp/tools/search.py` | Hybrid FTS + vector search |
| `src/inventory_mcp/backfill_embeddings.py` | NEW: Backfill CLI |
| `src/inventory_mcp/web/templates/base.html` | Relative URLs, protea icon |
| `src/inventory_mcp/web/templates/item.html` | Action buttons and forms |
| `src/inventory_mcp/web/templates/bin.html` | Sub-bin management |
| `src/inventory_mcp/web/static/app.js` | Action toggles, lightbox fixes |
| `src/inventory_mcp/web/static/favicon.svg` | NEW: King Protea favicon |
| `src/inventory_mcp/web/static/protea-icon.svg` | NEW: King Protea icon |
| `src/inventory_mcp/web/routes/pages.py` | Item action routes, sub-bin routes |
| `Dockerfile` | CPU-only PyTorch, optional embeddings |
| `.gitea/workflows/build-container.yml` | Cache management |

---

## Deployment Notes

After deploying, run the backfill to generate embeddings for existing items:

```bash
docker compose exec inventory-web inventory-backfill
```

This generates embeddings for all items (~1-2 minutes on CPU).

---

## Session Statistics

| Metric | Value |
|--------|-------|
| Commits today | 14 |
| New files | 5 |
| Modified files | 12 |
| Features added | 6 major |
| Issues resolved | 7 |

---

*Report generated: January 15, 2026*
